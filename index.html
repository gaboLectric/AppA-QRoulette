<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruleta de Preguntas</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carga de la fuente estilo cómic "Bangers" -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* Estilos personalizados para el look cómic */
        html, body {
            height: 100%;
            overflow: hidden;
            /* Fondo color crema como en la imagen de referencia */
            background-color: #FDF2E3; 
        }

        body {
            font-family: 'Bangers', cursive;
            letter-spacing: 2px;
            color: #2D2D2D;
        }

        /* Usamos Inter para las instrucciones para que sea más legible */
        .font-sans {
            font-family: 'Inter', sans-serif;
            letter-spacing: normal;
        }

        /* Contenedor principal que simula el "celular" o pantalla */
        #mainContainer {
            border: 8px solid black;
            border-radius: 24px;
            box-shadow: 12px 12px 0px rgba(0,0,0,0.8);
            background-color: white;
            /* Halftone dots pattern para el fondo de la pantalla */
            background-image: radial-gradient(circle at 1px 1px, rgba(0,0,0,0.2) 1px, transparent 0);
            background-size: 10px 10px;
        }

        /* Botón de girar (SPIN!) */
        .comic-button {
            font-family: 'Bangers', cursive;
            background-color: #FFD300; /* Amarillo brillante */
            border: 4px solid black;
            border-radius: 12px;
            box-shadow: 6px 6px 0px black;
            transition: all 0.1s ease-in-out;
            transform: rotate(-2deg); /* Ligera inclinación */
        }

        .comic-button:hover {
            transform: rotate(0deg) scale(1.05);
            box-shadow: 8px 8px 0px black;
        }

        .comic-button:active {
            transform: rotate(0deg) scale(0.95) translateY(2px);
            box-shadow: 2px 2px 0px black;
        }

        /* Indicador/Flecha de la ruleta */
        #pointer {
            width: 0;
            height: 0;
            /* Triángulo apuntando hacia abajo */
            border-left: 25px solid transparent;
            border-right: 25px solid transparent;
            border-top: 40px solid #FF0000; /* Rojo brillante */
            /* Sombra y borde para el puntero */
            filter: drop-shadow(4px 4px 0px rgba(0,0,0,0.6));
            position: absolute;
            top: -10px; /* Posicionado justo encima de la ruleta */
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            /* Borde negro para el triángulo */
            clip-path: polygon(0 0, 100% 0, 50% 100%);
        }
        
        #pointer::before {
            content: '';
            position: absolute;
            top: -42px; /* Ligeramente más pequeño y dentro */
            left: -28px;
            width: 0;
            height: 0;
            border-left: 28px solid transparent;
            border-right: 28px solid transparent;
            border-top: 44px solid black;
            z-index: -1;
            clip-path: polygon(0 0, 100% 0, 50% 100%);
        }


        /* El canvas de la ruleta */
        #wheelCanvas {
            transform-origin: center;
        }

        /* Contenedor de Pregunta/Respuesta */
        .qa-box {
            border: 4px dashed black;
            border-radius: 12px;
            background-color: #F0F0F0;
            min-height: 250px;
            padding: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        /* Simulación de burbuja de diálogo */
        .speech-bubble {
            position: relative;
            background: #F0F0F0;
            border-radius: 12px;
            border: 4px dashed black;
        }
        
        .speech-bubble:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 20%;
            width: 0;
            height: 0;
            border: 30px solid transparent;
            border-top-color: #F0F0F0;
            border-bottom: 0;
            border-left: 0;
            margin-left: -15px;
            margin-bottom: -34px;
            /* Trazo para el triángulo */
            filter: drop-shadow(0 4px 0 black);
        }

    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- Botón de Pantalla Completa -->
    <button id="fullscreenButton" class="comic-button absolute top-4 right-4 px-4 py-2 text-xl z-50" aria-label="Alternar pantalla completa">
        Pantalla Completa
    </button>

    <!-- Pantalla de Carga de Archivo (Visible al inicio) -->
    <div id="fileLoaderScreen" class="w-full max-w-lg p-8 text-center" role="main" aria-label="Carga de archivo de preguntas">
        <h1 class="text-6xl md:text-7xl text-center mb-6" style="transform: rotate(-3deg);" aria-label="Ruleta de Preguntas">¡Ruleta de Preguntas!</h1>
        <div class="bg-white p-6 md:p-10 border-4 border-black rounded-lg shadow-lg">
            <h2 class="text-3xl mb-4 font-sans font-bold text-gray-800">Carga tu archivo de preguntas</h2>
            <p class="text-lg mb-6 font-sans text-gray-600">
                Asegúrate de que tu archivo <code class="bg-gray-200 px-2 py-1 rounded">.txt</code> tenga el formato:
                <br>
                <strong class="text-gray-800">Pregunta 1 | Respuesta 1</strong>
                <br>
                (Un par por cada línea)
            </p>
            <input type="file" id="fileInput" accept=".txt" class="font-sans text-lg block w-full text-gray-700 bg-gray-100 border-2 border-gray-300 rounded-lg cursor-pointer file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:font-semibold file:bg-yellow-400 file:text-black hover:file:bg-yellow-500" aria-label="Selecciona un archivo de texto con preguntas y respuestas">
        </div>
    </div>

    <!-- Pantalla Principal del Juego (Oculta al inicio) -->
    <div id="gameScreen" class="hidden w-full max-w-6xl mx-auto p-4 md:p-8" role="main" aria-label="Juego de Ruleta de Preguntas">
        <h1 class="text-6xl md:text-8xl text-center mb-6" style="transform: rotate(-2deg);">Question Fate</h1>
        
        <div id="mainContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-12 p-6 md:p-10">
            
            <!-- Columna Izquierda: Ruleta y Botón -->
            <div class="flex flex-col items-center justify-around" aria-label="Controles de la ruleta">
                <div class="w-full max-w-sm relative flex items-center justify-center">
                    <!-- El indicador (flecha) -->
                    <div id="pointer" aria-label="Indicador de la ruleta" role="img"></div>
                    <!-- El canvas de la ruleta -->
                    <canvas id="wheelCanvas" width="400" height="400" role="img" aria-label="Ruleta de preguntas"></canvas>
                </div>
                
                <button id="spinButton" class="comic-button text-6xl px-16 py-4 mt-8" aria-label="Girar la ruleta">
                    Spin!
                </button>
                <button id="resetButton" class="comic-button text-3xl px-10 py-3 mt-4 bg-red-500 hover:bg-red-600" aria-label="Reiniciar juego">
                    Reiniciar
                </button>
                <button id="exitButton" class="comic-button text-3xl px-10 py-3 mt-4 bg-gray-500 hover:bg-gray-600" aria-label="Regresar a la pantalla inicial">
                    Salir al Inicio
                </button>
            </div>

            <!-- Columna Derecha: Preguntas y Respuestas -->
            <div class="flex flex-col justify-center items-center h-full" aria-label="Área de preguntas y respuestas">
                <div class="speech-bubble w-full">
                    <!-- Caja de Pregunta -->
                    <div id="questionBox" class="qa-box text-3xl md:text-4xl" role="region" aria-live="polite" aria-label="Área de pregunta">
                        <p>¡Gira la ruleta para empezar!</p>
                    </div>
                    <!-- Caja de Respuesta (oculta) -->
                    <div id="answerBox" class="qa-box text-3xl md:text-4xl hidden" role="region" aria-live="polite" aria-label="Área de respuesta">
                        <p>Respuesta...</p>
                    </div>
                </div>
                
                <div class="mt-12 text-center">
                    <p class="text-3xl" style="transform: rotate(2deg);">CATEGORY:</p>
                    <p id="categoryDisplay" class="text-5xl bg-blue-500 text-white px-8 py-2 border-4 border-black rounded-lg shadow-md">
                        ¡PREGUNTAS!
                    </p>
                    <p class="text-2xl mt-6 font-sans font-bold text-gray-700 animate-pulse" aria-label="Instrucción: Presiona ESPACIO para revelar la respuesta">
                        (Presiona ESPACIO para revelar la respuesta)
                    </p>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const fileLoaderScreen = document.getElementById('fileLoaderScreen');
        const gameScreen = document.getElementById('gameScreen');
        const fileInput = document.getElementById('fileInput');
        const wheelCanvas = document.getElementById('wheelCanvas');
        const spinButton = document.getElementById('spinButton');
        const resetButton = document.getElementById('resetButton');
        const exitButton = document.getElementById('exitButton');
        const questionBox = document.getElementById('questionBox');
        const answerBox = document.getElementById('answerBox');
        const fullscreenButton = document.getElementById('fullscreenButton');
        const ctx = wheelCanvas.getContext('2d');

        // --- Game Configuration ---
        const config = {
            numSegments: 8,
            segmentColors: ['#EF4444', '#3B82F6'], // Rojo y Azul como en la imagen
            maxQuestions: 50, // Maximum number of questions allowed
            maxQuestionLength: 500, // Maximum length of a question
            maxAnswerLength: 1000, // Maximum length of an answer
            spinDurationMin: 4, // Minimum spin duration in seconds
            spinDurationMax: 7, // Maximum spin duration in seconds
            minRotations: 5, // Minimum rotations during spin
            maxRotations: 9, // Maximum additional rotations
            fontSizeQuestion: 'bold 50px Bangers' // Font size for questions
        };

        // --- Game State ---
        let questions = [];
        let usedQuestions = []; // Array to track which questions have been shown
        let currentQuestion = null;
        let isSpinning = false;
        const segmentAngle = (2 * Math.PI) / config.numSegments;
        let currentRotation = 0; // Rotación actual en grados

        // --- Audio API ---
        let audioCtx;
        let spinOscillator;
        let spinGain;
        let clickOscillator;
        let clickGain;
        let clickInterval;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        // Sonido de "clic" de la ruleta
        function playClickSound() {
            if (!audioCtx) return;
            try {
                // Sonido corto y agudo
                const clickOsc = audioCtx.createOscillator();
                const clickG = audioCtx.createGain();
                
                clickOsc.type = 'sawtooth';
                clickOsc.frequency.setValueAtTime(1000, audioCtx.currentTime);
                clickOsc.frequency.exponentialRampToValueAtTime(400, audioCtx.currentTime + 0.1);
                
                clickG.gain.setValueAtTime(0.3, audioCtx.currentTime);
                clickG.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
                
                clickOsc.connect(clickG);
                clickG.connect(audioCtx.destination);
                
                clickOsc.start(audioCtx.currentTime);
                clickOsc.stop(audioCtx.currentTime + 0.1);
            } catch (e) {
                console.error("Error al reproducir sonido de clic:", e);
            }
        }

        // Sonido de "finalización" (ding!)
        function playEndSound() {
            if (!audioCtx) return;
            try {
                const osc = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                
                osc.type = 'sine';
                osc.frequency.setValueAtTime(1200, audioCtx.currentTime);
                g.gain.setValueAtTime(0.4, audioCtx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 1);
                
                osc.connect(g);
                g.connect(audioCtx.destination);
                
                osc.start(audioCtx.currentTime);
                osc.stop(audioCtx.currentTime + 1);
            } catch (e) {
                console.error("Error al reproducir sonido final:", e);
            }
        }

        // Sanitize text to prevent XSS
        function sanitizeText(text) {
            if (typeof text !== 'string') {
                return '';
            }
            
            // Remove any HTML tags and dangerous characters
            const temp = document.createElement('div');
            temp.textContent = text;
            return temp.innerHTML
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#x27;')
                .replace(/\//g, '&#x2F;');
        }

        // Validate question and answer lengths
        function validateQuestion(question, answer) {
            if (question.length > config.maxQuestionLength) {
                throw new Error(`La pregunta excede la longitud máxima de ${config.maxQuestionLength} caracteres.`);
            }
            if (answer.length > config.maxAnswerLength) {
                throw new Error(`La respuesta excede la longitud máxima de ${config.maxAnswerLength} caracteres.`);
            }
            return true;
        }

        // Show error message to user
        function showError(message) {
            // Clear current question display and show error
            questionBox.innerHTML = '';
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.style.color = 'red';
            errorDiv.style.fontWeight = 'bold';
            errorDiv.style.fontSize = '1.2rem';
            errorDiv.textContent = message;
            questionBox.appendChild(errorDiv);
        }

        // --- File Loading ---
        fileInput.addEventListener('change', handleFileLoad);

        function handleFileLoad(event) {
            try {
                const file = event.target.files[0];
                if (!file) {
                    console.warn('No file selected');
                    return;
                }
                
                // Validate file type
                if (!file.type || !file.type.startsWith('text/')) {
                    // Check if it's a .txt file by extension
                    if (!file.name.toLowerCase().endsWith('.txt')) {
                        throw new Error('Por favor, selecciona un archivo de texto (.txt)');
                    }
                }
                
                // Check file size (limit to 1MB)
                if (file.size > 1024 * 1024) {
                    throw new Error('El archivo es demasiado grande. Máximo 1MB permitido.');
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const text = e.target.result;
                        parseQuestions(text);
                        if (questions.length > 0) {
                            // Reset used questions array
                            usedQuestions = [];
                            // Inicia el audio context con un gesto de usuario
                            initAudio();
                            // Oculta la pantalla de carga y muestra el juego
                            fileLoaderScreen.classList.add('hidden');
                            gameScreen.classList.remove('hidden');
                            drawWheel();
                        } else {
                            showError("El archivo está vacío o no tiene el formato correcto (Pregunta | Respuesta).");
                        }
                    } catch (parseError) {
                        console.error('Error parsing questions:', parseError);
                        showError('Error al procesar el archivo: ' + parseError.message);
                    }
                };
                reader.onerror = () => {
                    console.error('Error reading file');
                    showError('Error al leer el archivo');
                };
                reader.readAsText(file);
            } catch (error) {
                console.error('File upload error:', error);
                showError(error.message);
            }
        }

        function parseQuestions(text) {
            // Split the content by newlines
            const lines = text.split('\n')
                .map(line => line.trim())
                .filter(line => line.includes('|') && line.trim() !== '');
            
            if (lines.length > config.maxQuestions) {
                throw new Error(`El archivo tiene demasiadas preguntas. Máximo ${config.maxQuestions} preguntas permitidas.`);
            }
            
            questions = [];
            
            // Process pairs of question and answer
            for (let i = 0; i < lines.length; i++) {
                const parts = lines[i].split('|');
                if (parts.length >= 2) {
                    const question = sanitizeText(parts[0].trim());
                    const answer = sanitizeText(parts[1].trim());
                    
                    // Validate question and answer lengths
                    validateQuestion(question, answer);
                    
                    questions.push({
                        question: question,
                        answer: answer
                    });
                }
            }
            
            console.log(`Cargadas ${questions.length} preguntas.`);
        }

        // --- Wheel Drawing ---
        function drawWheel() {
            const centerX = wheelCanvas.width / 2;
            const centerY = wheelCanvas.height / 2;
            const radius = centerX - 10; // Dejar un pequeño borde

            ctx.clearRect(0, 0, wheelCanvas.width, wheelCanvas.height);
            ctx.font = config.fontSizeQuestion;
            ctx.textBaseline = 'middle';
            ctx.textAlign = 'center';
            ctx.lineWidth = 4;
            ctx.strokeStyle = 'black'; // Líneas negras entre segmentos

            for (let i = 0; i < config.numSegments; i++) {
                const startAngle = i * segmentAngle;
                const endAngle = (i + 1) * segmentAngle;

                // Dibujar el segmento
                ctx.beginPath();
                ctx.fillStyle = config.segmentColors[i % 2];
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.closePath();
                ctx.fill();
                ctx.stroke(); // Dibujar el borde negro del segmento

                // Dibujar el signo de interrogación
                ctx.save();
                ctx.fillStyle = 'white';
                const textAngle = startAngle + segmentAngle / 2;
                const textX = centerX + (radius * 0.6) * Math.cos(textAngle);
                const textY = centerY + (radius * 0.6) * Math.sin(textAngle);
                ctx.translate(textX, textY);
                ctx.rotate(textAngle + Math.PI / 2); // Rotar el texto para que quede derecho
                ctx.fillText('?', 0, 0);
                ctx.restore();
            }
            
            // Dibujar el círculo central
            ctx.beginPath();
            ctx.fillStyle = '#FFD300'; // Amarillo
            ctx.arc(centerX, centerY, 30, 0, 2 * Math.PI);
            ctx.fill();
            ctx.stroke();
            ctx.beginPath();
            ctx.fillStyle = '#2D2D2D'; // Círculo interior oscuro
            ctx.arc(centerX, centerY, 15, 0, 2 * Math.PI);
            ctx.fill();
        }

        // --- Game Logic ---
        spinButton.addEventListener('click', spinWheel);
        resetButton.addEventListener('click', resetGame);
        exitButton.addEventListener('click', exitToHome);

        function resetDisplays() {
            questionBox.classList.remove('hidden');
            answerBox.classList.add('hidden');

            questionBox.innerHTML = '';
            const questionP = document.createElement('p');
            questionP.textContent = '¡Gira la ruleta para empezar!';
            questionBox.appendChild(questionP);

            answerBox.innerHTML = '';
            const answerP = document.createElement('p');
            answerP.textContent = 'Respuesta...';
            answerBox.appendChild(answerP);

            answerBox.style.backgroundColor = '#F0F0F0';
            answerBox.style.borderColor = 'black';
            answerBox.style.borderWidth = '4px';
        }

        function spinWheel() {
            if (isSpinning || questions.length === 0) return;

            isSpinning = true;
            currentQuestion = null;
            
            // Clear and update question box using textContent to prevent XSS
            questionBox.innerHTML = '';
            const p = document.createElement('p');
            p.textContent = 'Girando...';
            questionBox.appendChild(p);
            
            answerBox.classList.add('hidden');
            questionBox.classList.remove('hidden');
            
            // Sonido de clic rápido mientras gira
            if (audioCtx) {
                clickInterval = setInterval(playClickSound, 100);
            }

            // --- Animación de Giro con CSS ---
            const spinDuration = config.spinDurationMin + Math.random() * (config.spinDurationMax - config.spinDurationMin); // Configurable duration
            // Rotación: Mínimo 5 vueltas + una cantidad aleatoria
            const rotations = config.minRotations + Math.floor(Math.random() * (config.maxRotations - config.minRotations + 1)); // Configurable rotations
            const totalRotation = (currentRotation % 360) + (360 * rotations) + (Math.random() * 360);
            
            wheelCanvas.style.transition = `transform ${spinDuration}s cubic-bezier(0.25, 0.1, 0.25, 1)`;
            wheelCanvas.style.transform = `rotate(${totalRotation}deg)`;

            currentRotation = totalRotation; // Guardar la nueva rotación

            // Cuando la animación termina
            setTimeout(onSpinEnd, spinDuration * 1000);
        }
        
        function onSpinEnd() {
            isSpinning = false;
            if (clickInterval) {
                clearInterval(clickInterval);
            }
            playEndSound();

            // Sincronizar el estado de la rotación para el próximo giro
            // Esto es crucial para que los giros se acumulen
            const finalAngle = currentRotation % 360;
            wheelCanvas.style.transition = 'none';
            wheelCanvas.style.transform = `rotate(${finalAngle}deg)`;
            // Forzar un "reflow" para que el navegador aplique el cambio de 'none'
            wheelCanvas.offsetHeight; 
            
            // Get remaining questions that haven't been shown yet
            const remainingQuestions = questions.filter(q => !usedQuestions.includes(q));
            
            if (remainingQuestions.length === 0) {
                // No more questions to show
                currentQuestion = null;
                
                // Mostrar mensaje de que no hay más preguntas
                questionBox.innerHTML = '';
                const p = document.createElement('p');
                p.textContent = '¡Felicidades! Has completado todas las preguntas.';
                p.style.color = '#4ade80'; // Verde para indicar que se completó
                p.style.fontSize = '2rem';
                p.style.fontWeight = 'bold';
                questionBox.appendChild(p);
                
                answerBox.innerHTML = '';
                const answerP = document.createElement('p');
                answerP.textContent = 'Todas las preguntas han sido vistas';
                answerP.style.color = '#4ade80';
                answerP.style.fontWeight = 'bold';
                answerBox.appendChild(answerP);
                
                // Make answer box green to indicate completion
                answerBox.style.borderColor = '#22c55e';
                answerBox.style.backgroundColor = '#d1fae5';
                
                // Disable the spin button
                spinButton.disabled = true;
                spinButton.style.opacity = '0.5';
                spinButton.style.cursor = 'not-allowed';
                spinButton.textContent = '¡Completado!';
                
                const instructionsP = document.createElement('p');
                instructionsP.textContent = 'Usa "Salir al Inicio" para cargar un nuevo archivo cuando quieras continuar.';
                instructionsP.style.marginTop = '1rem';
                instructionsP.style.fontSize = '1.2rem';
                instructionsP.style.fontFamily = 'Inter, sans-serif';
                instructionsP.style.fontWeight = '600';
                questionBox.appendChild(instructionsP);
            } else {
                // Select a random question from remaining ones
                currentQuestion = remainingQuestions[Math.floor(Math.random() * remainingQuestions.length)];
                
                // Add to used questions
                usedQuestions.push(currentQuestion);
                
                // Mostrar la pregunta using textContent to prevent XSS
                questionBox.innerHTML = '';
                const p = document.createElement('p');
                p.textContent = currentQuestion.question;
                questionBox.appendChild(p);
                
                // Update answer display using textContent to prevent XSS
                answerBox.innerHTML = '';
                const answerP = document.createElement('p');
                answerP.textContent = currentQuestion.answer;
                answerBox.appendChild(answerP);
                
                // Reset answer box style if it was previously changed
                answerBox.style.borderColor = '';
                answerBox.style.backgroundColor = '';
                
                // Re-enable spin button if it was disabled
                if (spinButton.disabled) {
                    spinButton.disabled = false;
                    spinButton.style.opacity = '1';
                    spinButton.style.cursor = 'pointer';
                    spinButton.textContent = 'Spin!';
                    
                }
            }
        }

        // --- Reset Game ---
        function resetGame() {
            // Reset all game state variables
            usedQuestions = [];
            currentQuestion = null;
            
            // Reset question and answer display to defaults
            resetDisplays();
            
            // Re-enable spin button if it was disabled
            spinButton.disabled = false;
            spinButton.style.opacity = '1';
            spinButton.style.cursor = 'pointer';
            spinButton.textContent = 'Spin!';
            
            // Redraw the wheel to refresh the display
            drawWheel();
        }

        function exitToHome() {
            if (isSpinning) {
                return; // Avoid abrupt exit mid-spin
            }

            if (clickInterval) {
                clearInterval(clickInterval);
            }

            questions = [];
            usedQuestions = [];
            currentQuestion = null;

            // Reset UI elements to initial state
            resetDisplays();

            spinButton.disabled = false;
            spinButton.style.opacity = '1';
            spinButton.style.cursor = 'pointer';
            spinButton.textContent = 'Spin!';

            // Reset wheel orientation
            currentRotation = 0;
            wheelCanvas.style.transition = 'none';
            wheelCanvas.style.transform = 'rotate(0deg)';
            drawWheel();

            // Clear file input so the same file can be selected again if needed
            fileInput.value = '';

            // Restore initial screens
            gameScreen.classList.add('hidden');
            fileLoaderScreen.classList.remove('hidden');
        }


        // --- Answer Reveal (Spacebar) ---
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault(); // Evitar que la página haga scroll
                if (!isSpinning && currentQuestion) {
                    // Alternar entre pregunta y respuesta
                    questionBox.classList.toggle('hidden');
                    answerBox.classList.toggle('hidden');
                    
                    // Update ARIA attributes for screen readers
                    const isQuestionVisible = !questionBox.classList.contains('hidden');
                    questionBox.setAttribute('aria-hidden', !isQuestionVisible);
                    answerBox.setAttribute('aria-hidden', isQuestionVisible);
                    
                    // When answer is shown, add green indicator
                    const isAnswerNowVisible = !answerBox.classList.contains('hidden');
                    if (isAnswerNowVisible) {
                        // Add green styling to indicate correct answer
                        answerBox.style.backgroundColor = '#d1fae5';
                        answerBox.style.borderColor = '#22c55e';
                        answerBox.style.borderWidth = '4px';
                    } else {
                        // Remove green styling when showing question
                        answerBox.style.backgroundColor = '#F0F0F0'; // Color original
                        answerBox.style.borderColor = 'black';
                        answerBox.style.borderWidth = '4px'; // Mantener borde principal
                    }
                }
            }
        });

        // --- Fullscreen ---
        fullscreenButton.addEventListener('click', toggleFullscreen);

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                fullscreenButton.textContent = "Salir de Pantalla Completa";
                fullscreenButton.setAttribute('aria-label', 'Salir de pantalla completa');
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                    fullscreenButton.textContent = "Pantalla Completa";
                    fullscreenButton.setAttribute('aria-label', 'Alternar pantalla completa');
                }
            }
        }
        
        // Redibujar la ruleta si la ventana cambia de tamaño (aunque el canvas es fijo)
        window.addEventListener('resize', drawWheel);
    </script>
</body>
</html>